select category, sub_category, 
  // count(*) as cnt_orders
  COUNT(DISTINCT order_id) as cnt_orders
from records a
inner join customer_stats b
on a.customer_id = b.customer_id and a.order_date = b.first_order_date
group by category, sub_category
order by COUNT(DISTINCT order_id) desc


