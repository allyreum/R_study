select year,
  sum(case when shipping_method = 'Standard' then 1 else 0 end) standard,
  sum(case when shipping_method = 'Express' then 1 else 0 end) express,
  sum(case when shipping_method = 'Overnight' then 1 else 0 end) overnight
from (
  select year(purchased_at) as year, is_online_order, shipping_method
  from transactions
  where is_online_order = 1
  union all
  select year(purchased_at) as year, is_online_order, 'Standard' as shipping_method
  from transactions
  where is_online_order = 1 and is_returned = 1
) a
group by year
order by year

    
------------ GPT(테이블 1회 스캔) ------------------------------------------------------------
SELECT
    YEAR(purchased_at) AS year,
    SUM(CASE WHEN shipping_method = 'Standard' THEN 1 ELSE 0 END)
      + SUM(CASE WHEN is_returned = 1 THEN 1 ELSE 0 END) AS standard,
    SUM(CASE WHEN shipping_method = 'Express' THEN 1 ELSE 0 END) AS express,
    SUM(CASE WHEN shipping_method = 'Overnight' THEN 1 ELSE 0 END) AS overnight
FROM transactions
WHERE is_online_order = 1
GROUP BY YEAR(purchased_at)
ORDER BY year;
